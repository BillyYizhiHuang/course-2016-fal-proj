<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="d3-slider/d3.slider.css" />
<style>
  svg {
    font: 10px sans-serif;
  }

  .axis line, .axis path {
    shape-rendering: crispEdges;
    stroke: black;
    fill: none;
  }

  .bar {
    fill: steelblue;
    shape-rendering: crispEdges;
  }

  .text {
    fill: #fff;
  }

    
body {
    font-family: Verdana,Arial,sans-serif;
    width: 1000px;
    margin-left: auto;
    margin-right: auto;
}

h2 {
    font-size: 1.2em;
    margin: 60px 0 5px 0;
}

.wrapper {
    width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.wrapper > div {
    margin: 35px 0;
}


</style>
<body>
    
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="d3-slider/d3.slider.js"></script>

<form>
  <label for="binwidth">Binwidth</label>
  <select id="binwidth">
    <option value="5">5</option>
    <option value="10">10</option>
    <option selected value="20">20</option>
    <option value="50">50</option>
    <option value="100">100</option>
  </select>
</form>

<script>


  var margin = {top: 30, right: 20, bottom: 30, left: 50}
          , width = 960 - margin.left - margin.right
          , height = 450 - margin.top - margin.bottom;

  var xScale = d3.scale.linear()
          .range([0, width]);

  var yScale = d3.scale.linear()
          .range([height, 0]);

  var xAxis = d3.svg.axis()
          .scale(xScale)
          .orient("bottom").ticks(5);

  var yAxis = d3.svg.axis()
          .scale(yScale)
          .orient("left").ticks(5);

  var svg = d3.select('body').append('svg')
          .attr('width', width + margin.right + margin.left)
          .attr('height', height + margin.top + margin.bottom)
          .append('g')
          .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

// Get the data
d3.json("data.json", function(error, allData) {
    var radius = 20;
    data = allData[radius]["all"];
    var data = allData[radius]["all"];
    var xArr = [];
    var yArr = [];
    for (var key in data){
        var range = data[key];
        for (i = 0; i < range; i++){
            yArr.push(data[key]);
            xArr.push(parseInt(key));
        }
        }
    var d = [];
    d.x = xArr;
    d.y = yArr;
        
        var binwidth = parseInt(d3.select("#binwidth").node().value);
        xScale.domain([0, 250]);

        
        hist = d3.layout.histogram()
        
        .bins(d3.range(xScale.domain()[0], xScale.domain()[1]+binwidth, binwidth))
        (d.x);

        xBinwidth = width / hist.length -1;
        yScale.domain([0, d3.max(hist, function(d) { return d.y; })])

        svg.selectAll(".bar")
        .data(hist)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("width", function(d) { return xBinwidth })
        .attr("height", function(d) { return height- yScale(d.y)-1; })
        .attr("x", function(d) {return xScale(d.x)})
        .attr("y", function(d) {return yScale(d.y)});
        
        svg.selectAll(".text")
        .data(hist)
        .enter()
        .append("text")
        .attr("class", "text")
        .attr("x", function(d) {return xScale(d.x + binwidth/2)})
        .attr("y", function(d) {return yScale(d.y) + 14})
        .attr("text-anchor", "middle")
        .text(function(d) { return d.y; });
        
        svg.append("text")
        .attr("class", "x label")
        .attr("text-anchor", "middle")
        .attr("x", width/2)
        .attr("y", height + margin.bottom-3)
        .text("Time (ms)");
        
        d3.selectAll("#binwidth").on("change", update);
        
        // draw the x axis
        svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);
        
        // draw the x axis
        svg.append("g")
        .attr("class", "y axis")
        .call(yAxis);
        
        
        function update() {
        binwidth = parseInt(d3.select("#binwidth").node().value);
        xScale.domain([0, radius*12])
        
        hist = d3.layout.histogram()

        .bins(d3.range(xScale.domain()[0], xScale.domain()[1]+binwidth, binwidth))
        (d.x);
        
        yScale.domain([0, d3.max(hist, function(d) { return d.y; })]);
        xBinwidth =  width / hist.length -1
        
        svg.selectAll(".bar").data(hist)
        .enter().append("rect")
        .attr("class", "bar");
        
        svg.selectAll(".bar").data(hist)
        .attr("height", function(d) { return height- yScale(d.y)-1; })
        .attr("width", function(d) { return xBinwidth; })
        .attr("x", function(d) {return xScale(d.x)})
        .attr("y", function(d) {return yScale(d.y)});
        
        svg.selectAll(".bar").data(hist).exit()
        .remove();
        
        if (binwidth > 20) {
        
        svg.selectAll(".text").data(hist)
        .enter().append("text")
        .attr("class", "text")
        .attr("text-anchor", "middle");
        
        svg.selectAll(".text").data(hist)
        .attr("x", function(d) {return xScale(d.x + binwidth/2)})
        .attr("y", function(d) {return yScale(d.y) + 14 })
        .text(function(d) { return d.y; })
        
        svg.selectAll(".text").data(hist).exit()
        .remove();
        }
        else {
        svg.selectAll(".text").data(hist).remove();
        }
        
        d3.select(".y.axis").call(yAxis);
        d3.select(".x.axis").call(xAxis);
        }
        
        
        
        d3.select('#slider1').call(d3.slider().value(20).axis(true).min(0).max(49).step(1).on("slide", function(evt, value){
                                                                                    radius = value;
                                                                                    data = allData[radius]["all"];
                                                                                    xArr = [];
                                                                                    yArr = [];
                                                                                    for (var key in data){
                                                                                    var range = data[key];
                                                                                    for (i = 0; i < range; i++){
                                                                                        yArr.push(data[key]);
                                                                                        xArr.push(parseInt(key));
                                                                                    }
                                                                                    }
                                                                                    d = [];
                                                                                    d.x = xArr;
                                                                                    d.y = yArr;
                                                                                    update();
                                                                                    
                                                                                    
                                                                                    console.log("The slider's current value is:" + value);
                                                                                    }));
        
        
        });
        
    </script>
    <div class="wrapper">
    <div id="slider1"></div>

    </div>

    <script>


    </script>




</body>










